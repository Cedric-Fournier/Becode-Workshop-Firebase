<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./style.css">
    <title>Workshop Google Firebase</title>


    <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
    <script>
      // Initialize Firebase
      const config = {
        apiKey: "AIzaSyB90CMYuzH3AgbDn_8_SCJVBVCrMnDEDao",
        authDomain: "cedric-fournier.firebaseapp.com",
        databaseURL: "https://cedric-fournier.firebaseio.com",
        projectId: "cedric-fournier",
        storageBucket: "cedric-fournier.appspot.com",
        messagingSenderId: "105643866558"
      };
      firebase.initializeApp(config);

      const database = firebase.database();

      // Je crée les noms en FR de mon Objet
      const keyLang = {
        birthday: "Anniversaire",
        city: "Ville",
        firstname: "Prénom",
        lastname: "Nom",
        mail: "E-mail"
      };

      function reloadData(snapshot){
        document.getElementById("myList").innerHTML = "";
        snapshot.forEach((item) => {
          const data = item.val();

          let newData = {
            firstname: data.firstname,
            lastname: data.lastname,
            birthday: data.birthday,
            city: data.city,
            mail: data.mail
          }

          let nodeUser = document.createElement("LI");
          let nodeUserUL = document.createElement("UL");

          for(let i in newData) {
            let propertyValue = document.createTextNode(keyLang[i] + " : " + newData[i]);
            let nodeUserLI = document.createElement("LI");
            nodeUserLI.appendChild(propertyValue);
            nodeUserUL.appendChild(nodeUserLI);
          }

          nodeUser.appendChild(nodeUserUL);
          document.getElementById("myList").appendChild(nodeUser);
        });
      }

      // Afficher mes Objets
      const rootRef = database.ref("users/");
      rootRef.on("value", function(snapshot){
        reloadData(snapshot);
      });

        // Add un objet
        function writeData(form) {
          console.log(form.userId.value);
          database.ref('users/' + form.userId.value).set({
            firstname: form.firstname.value,
            lastname: form.lastname.value,
            birthday: form.birthday.value,
            city: form.city.value,
            mail: form.mail.value
          });
        }

    </script>

  </head>
  <body>

    <form class="addFirebase" action="index.html" onsubmit="writeData(this); return false;" method="post">
      <label>User: </label><input type="text" name="userId" placeholder="User"><br>
      <label>Nom: </label><input type="text" name="firstname" placeholder="Votre nom"><br>
      <label>Prénom: </label><input type="text" name="lastname" placeholder="Votre prénom"><br>
      <label>Anniversaire: </label><input type="text" name="birthday" placeholder="Votre annversaire"><br>
      <label>Ville: </label><input type="text" name="city" placeholder="Votre ville"><br>
      <label>E-mail: </label><input type="email" name="mail" placeholder="Votre E-mail"><br>
      <button type="submit" name="button">Envoyer</button>
    </form>

    <ul id="myList">
    </ul>
  </body>
</html>
