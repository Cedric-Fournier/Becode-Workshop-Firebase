<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./style.css">
    <title>Workshop Google Firebase</title>


    <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
    <script>
      // Initialize Firebase
      const config = {
        apiKey: "AIzaSyB90CMYuzH3AgbDn_8_SCJVBVCrMnDEDao",
        authDomain: "cedric-fournier.firebaseapp.com",
        databaseURL: "https://cedric-fournier.firebaseio.com",
        projectId: "cedric-fournier",
        storageBucket: "cedric-fournier.appspot.com",
        messagingSenderId: "105643866558"
      };
      firebase.initializeApp(config);

      const database = firebase.database();

      // Je crée les noms en FR de mon Objet
      const keyLang = {
        birthday: "Anniversaire",
        city: "Ville",
        firstname: "Prénom",
        lastname: "Nom",
        mail: "E-mail"
      };

      function reloadData(snapshot){
        document.getElementById("myList").innerHTML = "";
        snapshot.forEach((item) => {
          const data = item.val();

          let newData = {
            firstname: data.firstname,
            lastname: data.lastname,
            birthday: data.birthday,
            city: data.city,
            mail: data.mail
          }

          let nodeUser = document.createElement("LI");
          let nodeUserUL = document.createElement("UL");

          for(let i in newData) {
            let propertyValue = document.createTextNode(keyLang[i] + " : " + newData[i]);
            let nodeUserLI = document.createElement("LI");
            nodeUserLI.appendChild(propertyValue);
            nodeUserUL.appendChild(nodeUserLI);
          }

          nodeUser.appendChild(nodeUserUL);
          document.getElementById("myList").appendChild(nodeUser);
        });
      }

      // Afficher mes Objets
      const rootRef = database.ref("users/");
      rootRef.on("value", function(snapshot){
        reloadData(snapshot);
      });

        // Add un objet
        function writeData(form) {
          database.ref('users/' + form.userId.value).set({
            firstname: form.firstname.value,
            lastname: form.lastname.value,
            birthday: form.birthday.value,
            city: form.city.value,
            mail: form.mail.value
          });
        }

        // Delete un objet
        function deleteData(form) {
          database.ref('users/' + form.userId.value).remove()
            .then(function() {
              console.log("Remove succeeded.")
            })
            .catch(function(error) {
              console.log("Remove failed: " + error.message)
            });
        }

    </script>

  </head>
  <body>

    <div class="AddUpDel">
      <h1>Firebase est ton ami !</h1>
      <h2>Add Object (Ajouter une personne)</h2>
      <form class="addFirebase" action="index.html" onsubmit="writeData(this); return false;" method="post">
        <div class="user"><label>User(id): </label><input type="text" name="userId" placeholder="User"></div>
        <label>Nom: </label><input type="text" name="lastname" placeholder="Nom"><br>
        <label>Prénom: </label><input type="text" name="firstname" placeholder="Prénom"><br>
        <label>Anniversaire: </label><input type="text" name="birthday" placeholder="Annversaire"><br>
        <label>Ville: </label><input type="text" name="city" placeholder="Ville"><br>
        <label>E-mail: </label><input type="email" name="mail" placeholder="E-mail"><br>
        <button type="submit" name="button">Envoyer</button>
        <button type="button" name="button">Clear</button>
      </form>

      <h2>Upgrade Object (Modifier une personne)</h2>
      <form class="addFirebase" action="index.html" onsubmit="writeData(this); return false;" method="post">
        <div class="user"><label>User(id): </label><input type="text" name="userId" placeholder="User"></div>
        <label>Nom: </label><input type="text" name="lastname" placeholder="Nom"><br>
        <label>Prénom: </label><input type="text" name="firstname" placeholder="Prénom"><br>
        <label>Anniversaire: </label><input type="text" name="birthday" placeholder="Annversaire"><br>
        <label>Ville: </label><input type="text" name="city" placeholder="Ville"><br>
        <label>E-mail: </label><input type="email" name="mail" placeholder="E-mail"><br>
        <button type="submit" name="button">Envoyer</button>
        <button type="button" name="button">Clear</button>
      </form>

      <h2>Delete Object (Supprimer une personne)</h2>
      <form class="addFirebase" action="index.html" onsubmit="deleteData(this); return false;" method="post">
        <div class="user"><label>User(id): </label><input type="text" name="userId" placeholder="User"></div>
        <button type="submit" name="button">Envoyer</button>
      </form>
    </div>

    <div class="display">
      <h2>Affichage DB</h2>
      <ul id="myList">
      </ul>
    </div>

  </body>
</html>
