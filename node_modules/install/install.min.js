makeInstaller=function(n){"use strict";var t=(n=n||{}).extensions||[".js",".json"],r=n.fallback,f=n.mainFields||(n.browser?["browser","main"]:["main"]),e={}.hasOwnProperty;function u(n,t){return h(n)&&m(t)&&e.call(n,t)}var s,c,l={},a=new w("/",new w("/..")),o=b(a);function d(n,t){return h(n)&&function r(o,t,i){Array.isArray(t)?(t.forEach(function(n){m(n)?o.deps[n]=o.module.id:v(n)?t=n:h(n)&&(o.stub=o.stub||{},k(n,function(n,t){o.stub[t]=n}))}),v(t)||(t=null)):v(t)||m(t)||h(t)||(t=null);t&&(o.contents=o.contents||(h(t)?{}:t),h(t)&&j(o)&&k(t,function(n,t){if(".."===t)e=o.parent;else{var e=p(o.contents,t);e||((e=o.contents[t]=new w(o.module.id.replace(/\/*$/,"/")+t,o)).options=i)}r(e,n,i)}))}(a,n,t),o}function i(n){this.id=n,this.children=[],this.childrenById={}}function p(n,t){return u(n,t)&&n[t]}function h(n){return null!==n&&"object"==typeof n}function v(n){return"function"==typeof n}function m(n){return"string"==typeof n}function y(n){return new Error("Cannot find module '"+n+"'")}function b(n){var t=n.module;function e(n){return t.require(n)}return e.extensions=I(n).slice(0),e.resolve=function(n){return t.resolve(n)},e}function w(n,t){var e=this;e.parent=t=t||null,e.module=new i(n),(l[n]=e).contents=null,e.deps={}}function x(n,t){var e=n.module;if(!u(e,"exports")){var r=n.contents;if(!r){if(n.stub)return n.stub;throw y(e.id)}if(t){var o=(e.parent=t).children;Array.isArray(o)&&o.push(e)}r(b(n),e.exports=n.stub||{},e,n.module.id,n.parent.module.id),e.loaded=!0}var i=e.runSetters||e.runModuleSetters;return v(i)&&i.call(e),e.exports}function j(n){return n&&h(n.contents)}function k(t,e,n){Object.keys(t).forEach(function(n){e.call(this,t[n],n)},n)}function I(n){return n.options&&n.options.extensions||t}function g(n,t,e){for(;n&&!j(n);)n=n.parent;if(!n||!t||"."===t)return n;if(".."===t)return n.parent;var r=p(n.contents,t);if(e&&(!r||j(r)))for(var o=0;o<e.length;++o){var i=p(n.contents,t+e[o]);if(i&&!j(i))return i}return r}function A(e,n,r){var o=n.split("/");return o.every(function(n,t){return e=t<o.length-1?g(e,n):g(e,n,r)}),e}function B(n,t){var e=t&&t.module;n&&e&&(n.childrenById[e.id]=e)}function E(n,t,e,r){e=e||n.module;var o=I(n);for(n="/"===t.charAt(0)?A(a,t,o):"."===t.charAt(0)?A(n,t,o):function(n,t,e){for(var r;n&&!r;n=n.parent)r=j(n)&&A(n,"node_modules/"+t,e);return r}(n,t,o);j(n);){if((r=r||[]).indexOf(n)<0){r.push(n);var i,u=g(n,"package.json"),s=u&&x(u,e);if(s&&f.some(function(n){return m(i=s[n])})){var c=A(n,i,o)||E(n,i,e,r);if(c){n=c,B(e,u);continue}}}n=g(n,"index",o)}return n&&m(n.contents)&&(n=E(n,n.contents,e,r)),B(e,n),n}return d.fetch=function(n){throw new Error("fetch not implemented")},i.prototype.prefetch=function(e){var r=this,o=(p(l,r.id),s=s||Promise.resolve());function i(n){var t,e=p(l,n.id);(t=e)&&null===t.contents&&!e.pending&&(e.pending=!0,(c=c||{})[n.id]={module:e.module,deps:Object.keys(e.deps),options:e.options,stub:e.stub},k(e.deps,function(n,t){E(e,t)}),k(n.childrenById,i))}return s=new Promise(function(n){var t=r.resolve(e);k(r.childrenById,i),n(t)}).then(function(e){var n=c;return c=null,Promise.resolve(n&&d.fetch(n)).then(function(n){function t(){return d(n),e}return o.then(t,t)})})},(d.Module=i).prototype.resolve=function(n){var t=E(l[this.id],n);if(t)return t.module.id;var e=y(n);if(r&&v(r.resolve))return r.resolve(n,this.id,e);throw e},i.prototype.require=function(n){var t=E(l[this.id],n);if(t)return x(t,this);var e=y(n);if(v(r))return r(n,this.id,e);throw e},d},"object"==typeof exports&&(exports.makeInstaller=makeInstaller);
